<polymer-element name="folder-list" attributes="files">
    <template>
        <style>
        </style>
        
        <ul>
            <template repeat="{{file in files}}">
                <li>
                    <span class='name' on-tap="open(file)">{{file.name}}</span>
                    <span class='extension'>.{{file.extension}}</span>
                    <span class='size magnitude_{{file.unit}}'>{{file.size}} {{file.unit}}</span>
                    <template if="{{file.type=='folder'}}">
                        <folder-list files="{{file.files}}"></folder-list>
                    </template>
                </li>
            </template>
        </ul>
    </template>
    <script>
        Polymer({ // http://api.max.pub/Files/?list=./
            makeFile: function(path, name, size){
                var base = name.split('.').slice(0,-1).join('.');
                var ext = name.split('.').slice(-1)[0];
                var siz = [size,'B'];
                if(size>1024) siz = [Math.round(size/1024),'K'];
                if(size>1024*1024) siz = [Math.round(size/1024/1024),'M'];
                return {path:path, name:base, extension:ext, size:siz[0], unit:siz[1], type:'file'};
            },

            makeFolder: function(folder){
                var f = {name:folder.path.split('/').slice(-1)[0], 
                         path:folder.path, 
                         type:'folder', 
                         files:[]
                        };
                for(var file in folder.files)
                    if(folder.files[file]==='folder') {
                        var path = (folder.path=='/'?'':folder.path) + '/'+file; 
                        var add = {name:file, 
                                   path:path, 
                                   type:'folder', 
                                   files:[]
                                  };
                        out.files.push( add );
                    } else
                        out.files.push( makeFile(folder.path, file, folder.files[file]) );
                
                out.files.sort(fileSort);
            }
        });
    </script>
</polymer-element>
    
